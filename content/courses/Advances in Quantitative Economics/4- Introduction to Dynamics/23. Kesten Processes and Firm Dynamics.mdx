---
title: Kesten Processes and Firm Dynamics
draft: false
summary: test
---

import TOCInline from 'pliny/ui/TOCInline';

<TOCInline toc={props.toc} asDisclosure />

# Analyzing Kesten Processes and Their Impact on Business Growth

To follow this lecture, you'll need these additional libraries beyond what's included in Anaconda:

```python
!pip install quantecon
!pip install --upgrade yfinance
```

## Introduction

Building on our previous discussion of linear scalar-valued stochastic processes (AR(1) models), we now expand our focus to include models where the multiplicative coefficient is also stochastic.

These models, known as Kesten processes, are named after the German-American mathematician Harry Kesten (1931-2019).

Kesten processes are noteworthy for two main reasons:

1. They can describe several important economic phenomena.
2. They generate intriguing dynamics, sometimes resulting in heavy-tailed cross-sectional distributions.

We'll explore these aspects in detail throughout this lecture.

Let's begin by importing the necessary libraries:

```python
import matplotlib.pyplot as plt
plt.rcParams["figure.figsize"] = (11, 5)  #set default figure size
import numpy as np
import quantecon as qe
```

    OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.

The following code is included to prevent a `FutureWarning` caused by compatibility issues between pandas and matplotlib.

```python
from pandas.plotting import register_matplotlib_converters
register_matplotlib_converters()
```

For more technical background related to this topic, refer to the monograph by [[Buraczewski _et al._, 2016](/courses/Introduction-to-Quantitative-Economics/References#id59)].

## Understanding Kesten Processes

A **Kesten process** is defined as a stochastic process with the following form:

$$
X_{t+1} = a_{t+1} X_t + \eta_{t+1} \tag{23.1}
$$

where $ \{a*t\}*{t \geq 1} $ and $ \{\eta*t\}*{t \geq 1} $ are independent and identically distributed (IID) sequences.

Our focus is on the behavior of $ \{X*t\}*{t \geq 0} $ given an initial value $ X_0 $.

We'll concentrate on the nonnegative scalar case, where $ X*t $ is in $ \mathbb R*+ $.

Specifically, we'll assume that:

- The initial condition $ X_0 $ is nonnegative,
- $ \{a*t\}*{t \geq 1} $ is a nonnegative IID stochastic process, and
- $ \{\eta*t\}*{t \geq 1} $ is another nonnegative IID stochastic process, independent of the first.

### Example: GARCH Volatility Model

The GARCH model is frequently used in financial applications to analyze time series with varying volatility, such as asset returns.

Consider this graph of daily returns for the Nasdaq Composite Index from January 1, 2006, to November 1, 2019:

```python
import yfinance as yf

s = yf.download('^IXIC', '2006-1-1', '2019-11-1')['Adj Close']

r = s.pct_change()

fig, ax = plt.subplots()

ax.plot(r, alpha=0.7)

ax.set_ylabel('returns', fontsize=12)
ax.set_xlabel('date', fontsize=12)

plt.show()
```

[*********************100%***********************] 1 of 1 completed

<div
  className="my-1 overflow-hidden px-2 xl:my-1 xl:w-1/2 xl:px-2"
  style={{
    display: 'block',
    marginLeft: 'auto',
    marginRight: 'auto',
    width: '90%',
    alignItems: 'center',
    justifyContent: 'center',
  }}
>
  ![png](/static/courses/Advances%20in%20Quantitative%20Economics/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_files/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_11_2.png)
</div>

Notice how the data shows periods of high volatility (large variance) followed by calmer periods.

GARCH models can replicate this pattern.

The GARCH(1, 1) volatility process is expressed as:

$$
\sigma_{t+1}^2 = \alpha_0 + \sigma_t^2 (\alpha_1 \xi_{t+1}^2 + \beta) \tag{23.2}
$$

where $ \{\xi_t\} $ is IID with $ \mathbb E \xi_t^2 = 1 $ and all parameters are positive.

Asset returns are then modeled as:

$$
r_t = \sigma_t \zeta_t \tag{23.3}
$$

where $ \{\zeta_t\} $ is also IID and independent of $ \{\xi_t\} $.

The volatility sequence $ \{\sigma_t^2 \} $, which drives return dynamics, is a Kesten process.

### Example: Wealth Evolution

Consider a household that saves a constant fraction $ s $ of its current wealth each period.

The household earns labor income $ y_t $ at the beginning of period $ t $.

Wealth then changes according to:

$$
w_{t+1} = R_{t+1} s w_t + y_{t+1} \tag{23.4}
$$

where $ \{R_t\} $ represents the gross return on assets.

If both $ \{R_t\} $ and $ \{y_t\} $ are IID, then [(23.4)](#equation-wealth-dynam) is a Kesten process.

### Stationary Distributions

In previous lectures, such as the one on AR(1) processes, we introduced the concept of a stationary distribution.

In the context of Kesten processes, we can define a stationary distribution as follows:

A distribution $ F^\* $ on $ \mathbb R $ is called **stationary** for the Kesten process [(23.1)](#equation-kesproc) if:

$$
X_t \sim F^*
\quad \implies \quad
a_{t+1} X_t + \eta_{t+1} \sim F^* \tag{23.5}
$$

In other words, if the current state $ X*t $ follows distribution $ F^* $, then the next state $ X*{t+1} $ will also follow $ F^* $.

Alternatively, we can express this as:

$$
F^*(y) = \int \mathbb P\{ a_{t+1} x + \eta_{t+1} \leq y\} F^*(dx)
\quad \text{for all } y \geq 0. \tag{23.6}
$$

The left side represents the distribution of the next period's state when the current state is drawn from $ F^\* $.

The equality in [(23.6)](#equation-kp-stationary) indicates that this distribution remains unchanged.

### Interpreting Stationary Distributions Across Populations

Stationary distributions have an important interpretation when applied to populations, which is worth revisiting here.

For example, let's consider the distribution of wealth across households in a country.

Assume that:

- Each household's wealth evolves independently according to [(23.4)](#equation-wealth-dynam),
- $ F^\* $ is a stationary distribution for this process, and
- There are numerous households.

Under these conditions, $ F^\* $ represents a steady state for the country's cross-sectional wealth distribution.

In other words, if $ F^\* $ is the current wealth distribution, it will persist in future periods, all else being equal.

To illustrate this, let's assume $ F^\* $ is the present wealth distribution.

What proportion of households will have wealth below $ y $ in the next period?

To calculate this, we sum the probability that wealth will be less than $ y $ tomorrow, given that current wealth is $ w $, weighted by the fraction of households with wealth $ w $.

Noting that the proportion of households with wealth in the interval $ dw $ is $ F^\*(dw) $, we get:

$$
\int \mathbb P\{ R_{t+1} s w + y_{t+1} \leq y\} F^*(dw)
$$

Given the definition of stationarity and our assumption that $ \hat{F} $ is stationary for the wealth process, this equals $ \hat{F}(y) $.

Therefore, the proportion of households with wealth in $ [0, y] $ remains constant from one period to the next.

Since $ y $ was chosen arbitrarily, the entire distribution remains unchanged.

### Requirements for Stationarity

The Kesten process $ X*{t+1} = a*{t+1} X*t + \eta*{t+1} $ doesn't always have a stationary distribution.

For instance, if $ a_t \equiv \eta_t \equiv 1 $ for all $ t $, then $ X_t = X_0 + t $, which grows without bound.

To prevent such divergence, $ \{a_t\} $ must be strictly less than 1 most of the time.

Specifically, if:

$$
\mathbb E \ln a_t < 0
\quad \text{and} \quad
\mathbb E \eta_t < \infty \tag{23.7}
$$

then a unique stationary distribution exists on $ \mathbb R\_+ $.

- For slightly weaker conditions, see theorem 2.1.3 in [[Buraczewski _et al._, 2016](/courses/Introduction-to-Quantitative-Economics/References#id59)].

Applying this result, we can conclude that the wealth process [(23.4)](#equation-wealth-dynam) will have a unique stationary distribution when labor income has a finite mean and $ \mathbb E \ln R_t + \ln s < 0 $.

## Exploring Heavy-Tailed Distributions

Under certain conditions, the stationary distribution of a Kesten process exhibits a Pareto tail.

(For background on heavy-tailed distributions, refer to our previous lecture)

This characteristic is significant in economics due to the prevalence of Pareto-tailed distributions in various economic phenomena.

### The Kesten–Goldie Theorem Explained

To outline the conditions under which a Kesten process's stationary distribution has a Pareto tail, we first recall that a random variable is termed **nonarithmetic** if its distribution isn't concentrated on $ \{\dots, -2t, -t, 0, t, 2t, \ldots \} $ for any $ t \geq 0 $.

For example, any random variable with a density function is nonarithmetic.

The renowned Kesten–Goldie Theorem (see, e.g., [[Buraczewski _et al._, 2016](/courses/Introduction-to-Quantitative-Economics/References#id59)], theorem 2.4.4) states that if:

1. The stationarity conditions in [(23.7)](#equation-kp-stat-cond) are met,
2. The random variable $ a_t $ is positive with probability one and nonarithmetic,
3. $ \mathbb P\{a*t x + \eta_t = x\} < 1 $ for all $ x \in \mathbb R*+ $, and
4. There exists a positive constant $ \alpha $ such that:

$$
\mathbb E a_t^\alpha = 1,
\quad
\mathbb E \eta_t^\alpha < \infty,
\quad \text{and} \quad
\mathbb E [a_t^{\alpha+1} ] < \infty
$$

then the stationary distribution of the Kesten process has a Pareto tail with tail index $ \alpha $.

More precisely, if $ \hat{F} $ is the unique stationary distribution and $ \hat{X} \sim F^\* $, then:

$$
\lim_{x \to \infty} x^\alpha \mathbb P\{X^* > x\} = c
$$

for some positive constant $ c $.

### Understanding the Theorem

Later, we'll demonstrate the Kesten–Goldie Theorem using rank-size plots.

Before that, let's consider the intuition behind the conditions.

Two key conditions are $ \mathbb E \ln a_t < 0 $, ensuring model stationarity, and $ \mathbb E a_t^\alpha = 1 $ for some $ \alpha > 0 $.

The first condition implies that the distribution of $ a_t $ has significant probability mass below 1.

The second condition suggests that the distribution of $ a_t $ has at least some probability mass at or above 1.

The first condition ensures the existence of the stationary condition.

The second condition means that the current state can be amplified by $ a_t $.

If this occurs for several consecutive periods, the effects compound, as $ a_t $ is multiplicative.

This leads to spikes in the time series, which populate the extreme right tail of the distribution.

These spikes are visible in the following simulation, which generates 10 paths when $ a_t $ and $ b_t $ are lognormally distributed.

```python
μ = -0.5
σ = 1.0

def kesten_ts(ts_length=100):
    x = np.zeros(ts_length)
    for t in range(ts_length-1):
        a = np.exp(μ + σ * np.random.randn())
        b = np.exp(np.random.randn())
        x[t+1] = a * x[t] + b
    return x

fig, ax = plt.subplots()

num_paths = 10
np.random.seed(12)

for i in range(num_paths):
    ax.plot(kesten_ts())

ax.set(xlabel='time', ylabel='$X_t$')
plt.show()
```

<div
  className="my-1 overflow-hidden px-2 xl:my-1 xl:w-1/2 xl:px-2"
  style={{
    display: 'block',
    marginLeft: 'auto',
    marginRight: 'auto',
    width: '90%',
    alignItems: 'center',
    justifyContent: 'center',
  }}
>
  ![png](/static/courses/Advances%20in%20Quantitative%20Economics/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_files/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_20_0.png)
</div>

## Case Study: Business Growth Patterns

As mentioned in our lecture on heavy tails, common measures of firm size like revenue or employment in the US exhibit a Pareto tail distribution (see, e.g., [[Axtell, 2001](/courses/Introduction-to-Quantitative-Economics/References#id69)], [[Gabaix, 2016](/courses/Introduction-to-Quantitative-Economics/References#id68)]).

Let's explore how the Kesten–Goldie Theorem might explain this remarkable observation.

### Gibrat's Law Explained

Robert Gibrat proposed long ago that firm size changes according to a simple rule where future size is proportional to current size.

This concept is now referred to as Gibrat's law of proportional growth.

We can express this idea mathematically by stating that an appropriate measure $ s_t $ of firm size follows:

$$
\frac{s_{t+1}}{s_t} = a_{t+1} \tag{23.8}
$$

where $ \{a_t\} $ is a positive IID sequence.

One implication of Gibrat's law is that individual firms' growth rates are independent of their size.

However, in recent decades, research has emerged that contradicts Gibrat's law.

For example, it's commonly observed that:

1. Smaller firms tend to grow faster than larger firms (see, e.g., [[Evans, 1987](/courses/Introduction-to-Quantitative-Economics/References#id57)] and [[Hall, 1987](/courses/Introduction-to-Quantitative-Economics/References#id56)]), and
2. The growth rate of smaller firms is more volatile than that of larger firms [[Dunne _et al._, 1989](/courses/Introduction-to-Quantitative-Economics/References#id55)].

### Heavy-Tailed Distributions in Firm Size

How does this relate to Pareto tails?

The answer lies in the fact that [(23.9)](#equation-firm-dynam) is a Kesten process.

If the conditions of the Kesten–Goldie Theorem are met, then the firm size distribution is expected to have heavy tails — which aligns with observed data.

In the following exercises, we'll explore this concept further by generalizing firm size dynamics and examining the corresponding rank-size plots.

We'll also attempt to illustrate the significance of the Pareto tail finding for quantitative analysis.

## Exercises

## Exercise 23.1

Create a simulation and plot of 15 years of daily returns (assuming 250 working days per year) using the GARCH(1, 1) process described in [(23.2)](#equation-garch11v)–[(23.3)](#equation-garch11r).

Assume $ \xi_t $ and $ \zeta_t $ are independent and follow a standard normal distribution.

Use the following parameter values: $ \alpha_0 = 0.00001, \alpha_1 = 0.1, \beta = 0.9 $ and $ \sigma_0 = 0 $.

Visually compare your results with the Nasdaq Composite Index returns [shown earlier](#ndcode).

While the specific time path will differ, you should observe periods of high volatility.

## Solution to Exercise 23.1

Here's one possible solution:

```python
α_0 = 1e-5
α_1 = 0.1
β = 0.9

years = 15
days = years * 250

def garch_ts(ts_length=days):
    σ2 = 0
    r = np.zeros(ts_length)
    for t in range(ts_length-1):
        ξ = np.random.randn()
        σ2 = α_0 + σ2 * (α_1 * ξ**2 + β)
        r[t] = np.sqrt(σ2) * np.random.randn()
    return r

fig, ax = plt.subplots()

np.random.seed(12)

ax.plot(garch_ts(), alpha=0.7)

ax.set(xlabel='time', ylabel='$\\sigma_t^2$')
plt.show()
```

<div
  className="my-1 overflow-hidden px-2 xl:my-1 xl:w-1/2 xl:px-2"
  style={{
    display: 'block',
    marginLeft: 'auto',
    marginRight: 'auto',
    width: '90%',
    alignItems: 'center',
    justifyContent: 'center',
  }}
>
  ![png](/static/courses/Advances%20in%20Quantitative%20Economics/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_files/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_27_0.png)
</div>

## Exercise 23.2

In our discussion of firm dynamics, we claimed that [(23.9)](#equation-firm-dynam) better aligns with empirical literature than Gibrat's law in [(23.8)](#equation-firm-dynam-gb).

(The empirical findings were summarized just before [(23.9)](#equation-firm-dynam).)

Explain how this claim is justified (or refuted).

## Solution to Exercise 23.2

The empirical evidence suggests that:

1. Smaller firms grow more rapidly than larger firms
2. Growth rates of smaller firms show more volatility than those of larger firms

Additionally, Gibrat's law is generally considered a better approximation for large firms than for small ones

The claim is that the dynamics in [(23.9)](#equation-firm-dynam) better align with points 1-2 compared to Gibrat's law.

To understand why, we can rewrite [(23.9)](#equation-firm-dynam) in terms of growth dynamics:

$$
\frac{s_{t+1}}{s_t} = a_{t+1} + \frac{b_{t+1}}{s_t} \tag{23.10}
$$

Assuming $ s_t = s $ is given, the mean and variance of firm growth are

$$
\mathbb E a
+ \frac{\mathbb E b}{s}
\quad \text{and} \quad
\mathbb V a
+ \frac{\mathbb V b}{s^2}
$$

Both of these decrease as firm size $ s $ increases, which is consistent with the empirical data.

Furthermore, the law of motion [(23.10)](#equation-firm-dynam-2) clearly approaches Gibrat's law [(23.8)](#equation-firm-dynam-gb) as $ s_t $ becomes large.

## Exercise 23.3

Consider a general Kesten process as defined in [(23.1)](#equation-kesproc).

Assume that $ \{a_t\} $ follows a lognormal distribution with parameters $ (\mu, \sigma) $.

In other words, each $ a_t $ has the same distribution as $ \exp(\mu + \sigma Z) $ where $ Z $ is standard normal.

Further assume that $ \mathbb E \eta_t^r < \infty $ for all $ r > 0 $, which would be true if, for example, $ \eta_t $ is also lognormal.

Demonstrate that the conditions of the Kesten–Goldie theorem are satisfied if and only if $ \mu < 0 $.

Determine the value of $ \alpha $ that satisfies the Kesten–Goldie conditions.

## Solution to Exercise 23.3

Since $ a_t $ has a density, it is nonarithmetic.

Given that $ a_t $ has the same density as $ a = \exp(\mu + \sigma Z) $ where $ Z $ is standard normal, we have

$$
\mathbb E \ln a_t = \mathbb E (\mu + \sigma Z) = \mu,
$$

and since $ \eta_t $ has finite moments of all orders, the stationarity condition is met if and only if $ \mu < 0 $.

Given the properties of the lognormal distribution (which has finite moments of all orders), the only remaining condition to verify is the existence of a positive constant $ \alpha $ such that $ \mathbb E a_t^\alpha = 1 $.

This is equivalent to the statement

$$
\exp \left( \alpha \mu + \frac{\alpha^2 \sigma^2}{2} \right) = 1.
$$

Solving for $ \alpha $ yields $ \alpha = -2\mu / \sigma^2 $.

## Exercise 23.4

One unrealistic aspect of the firm dynamics specified in [(23.9)](#equation-firm-dynam) is that it doesn't account for market entry and exit.

In reality, we observe significant numbers of firms entering and exiting the market in any given period and market.

Empirical discussion of this phenomenon can be found in a seminal paper by Hugo Hopenhayn [[Hopenhayn, 1992](/courses/Introduction-to-Quantitative-Economics/References#id174)].

In this paper, Hopenhayn develops a model of entry and exit that incorporates profit maximization by firms and market-clearing quantities, wages, and prices.

In his model, a stationary equilibrium occurs when the number of new entrants equals the number of exiting firms.

In this context, firm dynamics can be expressed as

$$
s_{t+1} = e_{t+1} \mathbb{1}\{s_t < \bar s\} +
(a_{t+1} s_t + b_{t+1}) \mathbb{1}\{s_t \geq \bar s\} \tag{23.11}
$$

Here

- $ s_t $ represents productivity (a proxy for output and thus firm size),
- $ \{ e_t \} $ is an IID sequence representing productivity draws for new entrants, and
- $ \bar s $ is a threshold value, taken as given but determined endogenously in Hopenhayn's model.

The idea behind [(23.11)](#equation-firm-dynam-ee) is that firms remain in the market as long as their productivity $ s_t $ stays at or above $ \bar s $.

- In this case, their productivity updates according to [(23.9)](#equation-firm-dynam).

Firms choose to exit when their productivity $ s_t $ falls below $ \bar s $.

- In this case, they are replaced by a new firm with productivity $ e\_{t+1} $.

What can we infer about the dynamics?

Although [(23.11)](#equation-firm-dynam-ee) is not a Kesten process, it updates in the same way as a Kesten process when $ s_t $ is large.

So perhaps its stationary distribution still exhibits Pareto tails?

Your task is to investigate this question through simulation and rank-size plots.

The approach will be to

1. Generate $ M $ draws of $ s_T $ when $ M $ and $ T $ are large, and
2. Plot the largest 1,000 of the resulting draws in a rank-size plot.

(The distribution of $ s_T $ will approximate the stationary distribution when $ T $ is large.)

For the simulation, assume that

- each of $ a_t, b_t $ and $ e_t $ follows a lognormal distribution,
- the parameters are

```python
μ_a = -0.5        # location parameter for a
σ_a = 0.1         # scale parameter for a
μ_b = 0.0         # location parameter for b
σ_b = 0.5         # scale parameter for b
μ_e = 0.0         # location parameter for e
σ_e = 0.5         # scale parameter for e
s_bar = 1.0       # threshold
T = 500           # sampling date
M = 1_000_000     # number of firms
s_init = 1.0      # initial condition for each firm
```

## Solution to Exercise 23.4

Here's one possible solution.
First, we generate the observations:

```python
from numba import njit, prange
from numpy.random import randn


@njit(parallel=True)
def generate_draws(μ_a=-0.5,
                   σ_a=0.1,
                   μ_b=0.0,
                   σ_b=0.5,
                   μ_e=0.0,
                   σ_e=0.5,
                   s_bar=1.0,
                   T=500,
                   M=1_000_000,
                   s_init=1.0):

    draws = np.empty(M)
    for m in prange(M):
        s = s_init
        for t in range(T):
            if s < s_bar:
                new_s = np.exp(μ_e + σ_e *  randn())
            else:
                a = np.exp(μ_a + σ_a * randn())
                b = np.exp(μ_b + σ_b * randn())
                new_s = a * s + b
            s = new_s
        draws[m] = s

    return draws

data = generate_draws()
```

Now we create the rank-size plot:

```python
fig, ax = plt.subplots()

rank_data, size_data = qe.rank_size(data, c=0.01)
ax.loglog(rank_data, size_data, 'o', markersize=3.0, alpha=0.5)
ax.set_xlabel("log rank")
ax.set_ylabel("log size")

plt.show()
```

<div
  className="my-1 overflow-hidden px-2 xl:my-1 xl:w-1/2 xl:px-2"
  style={{
    display: 'block',
    marginLeft: 'auto',
    marginRight: 'auto',
    width: '90%',
    alignItems: 'center',
    justifyContent: 'center',
  }}
>
  ![png](/static/courses/Advances%20in%20Quantitative%20Economics/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_files/23.%20Kesten%20Processes%20and%20Firm%20Dynamics_37_0.png)
</div>

The resulting plot shows a straight line, which is consistent with a Pareto tail distribution.
