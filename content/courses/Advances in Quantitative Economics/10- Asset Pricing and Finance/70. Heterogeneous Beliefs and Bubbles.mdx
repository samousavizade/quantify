---
title: Heterogeneous Beliefs and Bubbles
draft: false
summary: test
---

import TOCInline from 'pliny/ui/TOCInline';

<TOCInline toc={props.toc} asDisclosure />

# Diverse Beliefs and Market Bubbles

In addition to what’s included in Anaconda, this lecture utilizes the following libraries:

```python
!pip install quantecon
```

## Overview

This lecture presents a variant of the model proposed by Harrison and Kreps [[Harrison and Kreps, 1978](/courses/Introduction-to-Quantitative-Economics/References#id130)].

The model determines the pricing of a dividend-yielding asset traded by two types of self-interested investors.

Key features of the model include:

- diverse beliefs
- incomplete markets
- constraints on short selling, and potentially $ \ldots $
- (leverage) limits on an investor’s borrowing capacity to finance risky asset purchases

Let's begin with some standard imports:

```python
import numpy as np
import quantecon as qe
import scipy.linalg as la
```

    OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.

### References

Before proceeding, you may want to review our lectures on:

- [Markov chains]
- [Asset pricing in finite state spaces]

### Market Bubbles

Economists have differing definitions of a _bubble_.

The Harrison-Kreps model illustrates a widely accepted notion of a bubble:

> _An asset price component can be considered a bubble if all investors concur that the current price exceeds what they believe the asset’s underlying dividend stream justifies_.

## Structure of the Model

The model simplifies things by ignoring alterations in the distribution of wealth
among investors who have hard-wired different beliefs about the fundamentals that determine
asset payouts.

There is a fixed number $ A $ of shares of an asset.

Each share entitles its owner to a stream of dividends $ \{d_t\} $ governed by a Markov chain defined on a state space $ S \in \{0, 1\} $.

The dividend obeys

$$
d_t =
\begin{cases}
0 & \text{ if } s_t = 0 \\
1 & \text{ if } s_t = 1
\end{cases}
$$

An owner of a share at the end of time $ t $ and the beginning of time $ t+1 $ is entitled to the dividend paid at time $ t+1 $.

Thus, the stock is traded **ex dividend**.

An owner of a share at the beginning of time $ t+1 $ is also entitled to sell the share to another investor during time $ t+1 $.

Two types $ h=a, b $ of investors differ only in their beliefs about a Markov transition matrix $ P $ with typical element

$$
P(i,j) = \mathbb P\{s_{t+1} = j \mid s_t = i\}
$$

Investors of type $ a $ believe the transition matrix

$$
P_a =
\begin{bmatrix}
\frac{1}{2} & \frac{1}{2} \\
\frac{2}{3} & \frac{1}{3}
\end{bmatrix}
$$

Investors of type $ b $ think the transition matrix is

$$
P_b =
\begin{bmatrix}
\frac{2}{3} & \frac{1}{3} \\
\frac{1}{4} & \frac{3}{4}
\end{bmatrix}
$$

Thus, in state $ 0 $, a type $ a $ investor is more optimistic about next period’s dividend than is investor $ b $.

But in state $ 1 $, a type $ a $ investor is more pessimistic about next period’s dividend than is investor $ b $.

The stationary (i.e., invariant) distributions of these two matrices can be calculated as follows:

```python
qa = np.array([[1/2, 1/2], [2/3, 1/3]])
qb = np.array([[2/3, 1/3], [1/4, 3/4]])
mca = qe.MarkovChain(qa)
mcb = qe.MarkovChain(qb)
mca.stationary_distributions
```

    array([[0.57142857, 0.42857143]])

```python
mcb.stationary_distributions
```

    array([[0.42857143, 0.57142857]])

The stationary distribution of $ P_a $ is approximately $ \pi_a = \begin{bmatrix} .57 & .43 \end{bmatrix} $.

The stationary distribution of $ P_b $ is approximately $ \pi_b = \begin{bmatrix} .43 & .57 \end{bmatrix} $.

Thus, a type $ a $ investor tends to be more pessimistic on average.

### Ownership Rights

An asset owner at the end of time $ t $ is entitled to the dividend at time $ t+1 $ and has the right to sell the asset at that time.

Both investor types are risk-neutral and share the same fixed discount factor $ \beta \in (0,1) $.

In our numerical example, we’ll set $ \beta = .75 $, as Harrison and Kreps [[Harrison and Kreps, 1978](/courses/Introduction-to-Quantitative-Economics/References#id130)] did.

We will eventually analyze the implications of two different assumptions regarding the number of shares $ A $ relative to the resources available to our two investor types for stock investment.

1. Both investor types possess sufficient resources (either wealth or borrowing capacity) to purchase the entire available stock of the asset [1].
1. No single investor type has enough resources to acquire the entire stock.

Case 1 is the scenario examined by Harrison and Kreps.

In case 2, both investor types always hold at least some of the asset.

### Short Sales Not Permitted

Short sales are prohibited.

This is significant as it limits how pessimists can express their views.

- They **can** express their opinions by selling their shares.
- They **cannot** express them more forcefully by artificially “creating shares” – that is, they cannot borrow shares from more optimistic investors and then immediately sell them.

### Optimism and Pessimism

The defined transition matrices $ P_a $ and $ P_b $, derived directly from Harrison and Kreps, incorporate stochastically alternating temporary optimism and pessimism.

Keep in mind that state $ 1 $ represents the high dividend state.

- In state $ 0 $, a type $ a $ agent is more optimistic about the next period’s dividend than a type $ b $ agent.
- In state $ 1 $, a type $ b $ agent is more optimistic about the next period’s dividend than a type $ a $ agent.

However, the stationary distributions $ \pi_a = \begin{bmatrix} .57 & .43 \end{bmatrix} $ and $ \pi_b = \begin{bmatrix} .43 & .57 \end{bmatrix} $ indicate that a type $ b $ individual is more optimistic about the dividend process in the long run compared to a type $ a $ individual.

### Information

Investors know a price function mapping the state $ s_t $ at $ t $ into the equilibrium price $ p(s_t) $ that prevails in that state.

This price function is endogenous and to be determined below.

When investors choose whether to purchase or sell the asset at $ t $, they also know $ s_t $.

## Model Resolution

Now let’s proceed to resolve the model.

We will determine equilibrium prices under a specific set of beliefs and trading constraints selected from one of the previously described specifications.

We will compare equilibrium price functions based on the following alternative assumptions about beliefs:

1. There is only one type of agent, either $ a $ or $ b $.
1. There are two types of agents differentiated solely by their beliefs. Each agent type has enough resources to acquire all of the asset (Harrison and Kreps’s setting).
1. There are two types of agents with differing beliefs, but due to limited wealth and/or leverage, both investor types hold the asset each period.

### Summary Table

The following table summarizes the findings obtained in the remainder of the lecture
(in an exercise, you will be asked to recreate the table and reinterpret its components).

The table reports implications of Harrison and Kreps’s specifications of $ P_a, P_b,... \beta $.

|    $ s_t $     |  0   |  1   |
| :------------: | :--: | :--: |
|    $ p_a $     | 1.33 | 1.22 |
|    $ p_b $     | 1.45 | 1.91 |
|    $ p_o $     | 1.85 | 2.08 |
|    $ p_p $     |  1   |  1   |
| $ \hat{p}\_a $ | 1.85 | 1.69 |
| $ \hat{p}\_b $ | 1.69 | 2.08 |

Here

- $ p_a $ represents the equilibrium price function under homogeneous beliefs $ P_a $
- $ p_b $ represents the equilibrium price function under homogeneous beliefs $ P_b $
- $ p_o $ represents the equilibrium price function under heterogeneous beliefs with optimistic marginal investors
- $ p_p $ represents the equilibrium price function under heterogeneous beliefs with pessimistic marginal investors
- $ \hat{p}\_a $ indicates the amount type $ a $ investors are willing to pay for the asset
- $ \hat{p}\_b $ indicates the amount type $ b $ investors are willing to pay for the asset

We will clarify these values and how they are computed one row at a time.

The row corresponding to $ p_o $ applies when both investor types have sufficient resources to acquire the entire stock of the asset and strict short sales constraints are in place, ensuring that temporarily optimistic investors always price the asset.

The row corresponding to $ p_p $ would apply if neither investor type has enough resources to purchase the entire stock of the asset and both types must hold the asset.

The row corresponding to $ p_p $ would also apply if both types have enough resources to acquire the entire stock of the asset, but short sales are possible, allowing temporarily pessimistic investors to price the asset.

### Homogeneous Belief Prices

We will begin by pricing the asset under homogeneous beliefs.

(This is the scenario explored in the lecture on asset pricing with finite Markov states)

Assuming that there is only one type of investor, either of type $ a $ or $ b $, and that this investor always “prices the asset”.

Let $ p_h = \begin{bmatrix} p_h(0) \cr p_h(1) \end{bmatrix} $ be the equilibrium price vector when all investors belong to type $ h $.

The current price equals the expected discounted value of tomorrow’s dividend and the asset's price tomorrow:

$$
p_h(s) = \beta \left( P_h(s,0) (0 + p_h(0)) + P_h(s,1) ( 1 + p_h(1)) \right), \quad s = 0, 1 \tag{70.1}
$$

These equations imply that the equilibrium price vector is

$$
\begin{bmatrix} p_h(0) \cr p_h(1) \end{bmatrix}
= \beta [I - \beta P_h]^{-1} P_h \begin{bmatrix} 0 \cr 1 \end{bmatrix} \tag{70.2}
$$

The first two rows of the table report $ p_a(s) $ and $ p_b(s) $.

Here’s a function that can be utilized to compute these values.

```python
def price_single_beliefs(transition, dividend_payoff, β=.75):
    """
    Function to Solve Single Beliefs
    """
    # First compute inverse piece
    imbq_inv = la.inv(np.eye(transition.shape[0]) - β * transition)

    # Next compute prices
    prices = β * imbq_inv @ transition @ dividend_payoff

    return prices
```

#### Homogeneous Belief Prices as Benchmarks

These equilibrium prices under homogeneous beliefs serve as crucial benchmarks for subsequent analysis.

- $ p_h(s) $ indicates what a type $ h $ investor considers the “fundamental value” of the asset to be.
- Here, “fundamental value” refers to the expected discounted present value of future dividends.

We will compare these fundamental asset values with equilibrium values when traders possess differing beliefs.

### Pricing with Diverse Beliefs

Several scenarios must be considered.

The first scenario occurs when both agent types have sufficient wealth to independently purchase all of the asset.

In this scenario,... the marginal investor pricing the asset is the more optimistic type, hence the equilibrium price $ \bar p $ satisfies Harrison and Kreps’s key equation:

$$
\bar p(s) =
\beta
\max
\left\{
P_a(s,0) \bar p(0) + P_a(s,1) ( 1 + \bar p(1))
,\;
P_b(s,0) \bar p(0) + P_b(s,1) ( 1 + \bar p(1))
\right\} \tag{70.3}
$$

for $ s=0,1 $.

In the above equation, the $ max $ on the right side is over the two prospective values of next period’s payout
from owning the asset.

The marginal investor pricing the asset in state $ s $ is of type $ a $ if

$$
P_a(s,0) \bar p(0) + P_a(s,1) ( 1 + \bar p(1)) >
P_b(s,0) \bar p(0) + P_b(s,1) ( 1 + \bar p(1))
$$

The marginal investor is of type $ b $ if

$$
P_a(s,1) \bar p(0) + P_a(s,1) ( 1 + \bar p(1)) <
P_b(s,1) \bar p(0) + P_b(s,1) ( 1 + \bar p(1))
$$

**Thus, the marginal investor is the (temporarily) optimistic type**.

Equation [(70.3)](#equation-hakr2) is a functional equation that, similar to a Bellman equation, can be solved by

- initiating with a guess for the price vector $ \bar p $ and
- iterating to convergence on the operator that maps a guess $ \bar p^j $ into an updated guess
  $ \bar p^{j+1} $ defined by the right side of [(70.3)](#equation-hakr2), specifically

$$
\bar p^{j+1}(s)
= \beta \max
\left\{
P_a(s,0) \bar p^j(0) + P_a(s,1) ( 1 + \bar p^j(1))
,\;
P_b(s,0) \bar p^j(0) + P_b(s,1) ( 1 + \bar p^j(1))
\right\} \tag{70.4}
$$

for $ s=0,1 $.

The third row of the table labeled $ p_o $ reports equilibrium prices that solve the functional equation when $ \beta = .75 $.

Here, the type that is optimistic about $ s\_{t+1} $ prices the asset in state $ s_t $.

It is informative to compare these prices with the equilibrium prices for homogeneous belief economies that solve under beliefs $ P_a $ and $ P_b $ reported in the rows labeled $ p_a $ and $ p_b $, respectively.

Equilibrium prices $ p_o $ in the heterogeneous beliefs economy evidently exceed what any prospective investor regards as the fundamental value of the asset in each possible state.

Nevertheless,... the economy recurrently visits a state that prompts each investor to
purchase the asset for more than he believes its future dividends are
worth.

An investor is willing to pay more than what he believes is justified by the fundamental value of the prospective dividend stream because he anticipates having the option later to sell the asset to another investor who will value the asset more highly than he will at that time.

- Investors of type $ a $ are willing to pay the following price for the asset

$$
\hat p_a(s) =
\begin{cases}
\bar p(0) & \text{ if } s_t = 0 \\
\beta(P_a(1,0) \bar p(0) + P_a(1,1) ( 1 + \bar p(1))) & \text{ if } s_t = 1
\end{cases}
$$

- Investors of type $ b $ are willing to pay the following price for the asset

$$
\hat p_b(s) =
\begin{cases}
\beta(P_b(0,0) \bar p(0) + P_b (0,1) ( 1 + \bar p(1))) & \text{ if } s_t = 0 \\
\bar p(1) & \text{ if } s_t =1
\end{cases}
$$

Clearly, $ \hat p_a(1) < \bar p(1) $ and $ \hat p_b(0) < \bar p(0) $.

Investors of type $ a $ prefer to sell the asset in state $ 1 $, while investors of type $ b $ prefer to sell it in state $ 0 $.

- The asset changes ownership whenever the state transitions from $ 0 $ to $ 1 $ or from $ 1 $ to $ 0 $.
- The valuations $ \hat p_a(s) $ and $ \hat p_b(s) $ are shown in the fourth and fifth rows of the table.
- Even pessimistic investors who do not purchase the asset believe that it is worth more than they estimate future dividends to be worth.

Here’s code to compute $ \bar p $, $ \hat p_a $, and $ \hat p_b $ using the iterative method described above.

```python
def price_optimistic_beliefs(transitions, dividend_payoff, β=.75,
                            max_iter=50000, tol=1e-16):
    """
    Function to Solve Optimistic Beliefs
    """
    # We will guess an initial price vector of [0, 0]
    p_new = np.array([[0], [0]])
    p_old = np.array([[10.], [10.]])

    # We know this is a contraction mapping, so we can iterate to conv
    for i in range(max_iter):
        p_old = p_new
        p_new = β * np.max([q @ p_old
                            + q @ dividend_payoff for q in transitions],
                            1)

        # If we succeed in converging, break out of for loop
        if np.max(np.sqrt((p_new - p_old)**2)) < tol:
            break

    ptwiddle = β * np.min([q @ p_old
                          + q @ dividend_payoff for q in transitions],
                          1)

    phat_a = np.array([p_new[0], ptwiddle[1]])
    phat_b = np.array([ptwiddle[0], p_new[1]])

    return p_new, phat_a, phat_b
```

### Inadequate Resources

Results vary when the more optimistic type of investor lacks sufficient wealth — or borrowing capability — to hold the entire stock of the asset.

In this scenario, the asset price must adjust to entice pessimistic investors.

Instead of equation [(70.3)](#equation-hakr2), the equilibrium price must satisfy

$$
\check p(s)
= \beta \min
\left\{
P_a(s,1) \check p(0) + P_a(s,1) ( 1 + \check p(1)) ,\;
P_b(s,1) \check p(0) + P_b(s,1) ( 1 + \check p(1))
\right\} \tag{70.5}
$$

In this case, the marginal investor who prices the asset is consistently the one who values it _less_ than the other type.

Now the marginal investor is always the (temporarily) pessimistic type.

Note from the sixth row that the pessimistic price $ p_o $ is lower than the homogeneous belief prices $ p_a $ and $ p_b $ in both states.

When pessimistic investors price the asset according to [(70.5)](#equation-harrkrep4), optimistic investors perceive the asset as underpriced.

If they could, optimistic investors would eagerly borrow at a one-period risk-free gross interest rate $ \beta^{-1} $ to acquire more of the asset.

Restrictions on leverage prevent them from doing so.

When optimistic investors price the asset as in equation [(70.3)](#equation-hakr2), pessimistic investors believe that the asset is overpriced and would like to short sell it.

However, short sale constraints inhibit that.

Here’s code to compute $ \check p $ using the iterative method.

```python
def price_pessimistic_beliefs(transitions, dividend_payoff, β=.75,
                            max_iter=50000, tol=1e-16):
    """
    Function to Solve Pessimistic Beliefs
    """
    # We will guess an initial price vector of [0, 0]
    p_new = np.array([[0], [0]])
    p_old = np.array([[10.], [10.]])

    # We know this is a contraction mapping, so we can iterate to conv
    for i in range(max_iter):
        p_old = p_new
        p_new = β * np.min([q @ p_old
                            + q @ dividend_payoff for q in transitions],
                           1)

        # If we succeed in converging, break out of for loop
        if np.max(np.sqrt((p_new - p_old)**2)) < tol:
            break

    return p_new
```

### Additional Insights

Jose Scheinkman [[Scheinkman, 2014](/courses/Introduction-to-Quantitative-Economics/References#id129)] interprets the Harrison-Kreps model as a bubble model — a scenario where an asset price exceeds what each investor believes is justified by their beliefs regarding the asset’s underlying dividend stream.

Scheinkman emphasizes the following aspects of the Harrison-Kreps model:

- High trading volume occurs when the Harrison-Kreps pricing formula [(70.3)](#equation-hakr2) is in effect.
- Type $ a $ investors sell the entire stock of the asset to type $ b $ investors whenever the state transitions from $ s_t =0 $ to $ s_t =1 $.
- Type $ b $ investors sell the asset to type $ a $ investors whenever the state shifts from $ s_t = 1 $ to $ s_t =0 $.

Scheinkman considers this a strength of the model, as he notes high trading volume during _notable bubbles_.

- If the _supply_ of the asset is significantly increased, either physically (more “houses” constructed) or artificially (new methods to short sell “houses” developed), bubbles will burst when the asset supply surpasses optimistic investors’ purchasing capacity.
- If optimistic investors finance their acquisitions through borrowing, tightening leverage constraints can extinguish a bubble.

Scheinkman derives insights regarding the impact of financial regulations on bubbles.

He highlights how restrictions on short sales and limits on leverage exert opposite effects.

## Exercises

## Exercise 70.1

This exercise encourages you to recreate the summary table using the functions we have developed previously.

|    $ s_t $     |  0   |  1   |
| :------------: | :--: | :--: |
|    $ p_a $     | 1.33 | 1.22 |
|    $ p_b $     | 1.45 | 1.91 |
|    $ p_o $     | 1.85 | 2.08 |
|    $ p_p $     |  1   |  1   |
| $ \hat{p}\_a $ | 1.85 | 1.69 |
| $ \hat{p}\_b $ | 1.69 | 2.08 |

To start, you will need to define the transition matrices and dividend payoff vector.

Additionally,... below we will provide an interpretation of the row corresponding to $ p_o $ by
introducing two new types of agents: one who is **permanently optimistic**, and the other who
is **permanently pessimistic**.

We will construct subjective transition probability matrices for our permanently optimistic and permanently pessimistic investors as follows.

The permanently optimistic investors (i.e., the investor with the most optimistic
beliefs in each state) believe the transition matrix

$$
P_o =
\begin{bmatrix}
\frac{1}{2} & \frac{1}{2} \\
\frac{1}{4} & \frac{3}{4}
\end{bmatrix}
$$

The permanently pessimistic investor believes the transition matrix

$$
P_p =
\begin{bmatrix}
\frac{2}{3} & \frac{1}{3} \\
\frac{2}{3} & \frac{1}{3}
\end{bmatrix}
$$

We will utilize these transition matrices when presenting our solution to exercise 1 below.

## Solution to Exercise 70.1

Initially, we will derive equilibrium price vectors under homogeneous beliefs, including scenarios where all
investors are either optimistic or pessimistic.

```python
qa = np.array([[1/2, 1/2], [2/3, 1/3]])    # Type a transition matrix
qb = np.array([[2/3, 1/3], [1/4, 3/4]])    # Type b transition matrix
# Optimistic investor transition matrix
qopt = np.array([[1/2, 1/2], [1/4, 3/4]])
# Pessimistic investor transition matrix
qpess = np.array([[2/3, 1/3], [2/3, 1/3]])

dividendreturn = np.array([[0], [1]])

transitions = [qa, qb, qopt, qpess]
labels = ['p_a', 'p_b', 'p_optimistic', 'p_pessimistic']

for transition, label in zip(transitions, labels):
    print(label)
    print("=" * 20)
    s0, s1 = np.round(price_single_beliefs(transition, dividendreturn), 2)
    print(f"State 0: {s0}")
    print(f"State 1: {s1}")
    print("-" * 20)
```

    p_a
    ====================
    State 0: [1.33]
    State 1: [1.22]
    --------------------
    p_b
    ====================
    State 0: [1.45]
    State 1: [1.91]
    --------------------
    p_optimistic
    ====================
    State 0: [1.85]
    State 1: [2.08]
    --------------------
    p_pessimistic
    ====================
    State 0: [1.]
    State 1: [1.]
    --------------------

We will employ the price_optimistic_beliefs function to determine the price under
heterogeneous beliefs.

```python
opt_beliefs = price_optimistic_beliefs([qa, qb], dividendreturn)
labels = ['p_optimistic', 'p_hat_a', 'p_hat_b']

for p, label in zip(opt_beliefs, labels):
    print(label)
    print("=" * 20)
    s0, s1 = np.round(p, 2)
    print(f"State 0: {s0}")
    print(f"State 1: {s1}")
    print("-" * 20)
```

    p_optimistic
    ====================
    State 0: [1.85]
    State 1: [2.08]
    --------------------
    p_hat_a
    ====================
    State 0: [1.85]
    State 1: [1.69]
    --------------------
    p_hat_b
    ====================
    State 0: [1.69]
    State 1: [2.08]
    --------------------

It is noteworthy that the equilibrium price with heterogeneous beliefs aligns with the price under single beliefs
with **permanently optimistic** investors - this occurs because the marginal investor in the heterogeneous beliefs equilibrium is consistently the type who is temporarily optimistic.

**[1]** By presuming that both types of agents consistently possess “deep enough pockets” to acquire all of the asset, the model excludes wealth dynamics from consideration. The Harrison-Kreps model generates high trading volume when the state transitions from 0 to 1 or from 1 to 0.
